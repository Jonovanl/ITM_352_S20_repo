<!--Author: Jonovan Lee-->
<!--File Description: Invoice Page-->
<script src="./product.js" type=""></script>
<script>
//Code used above does a get request for the product's list
//Taken from assignment 1 example
let parms =(new URL(document.location)).searchParams;

//processes the invoice to create form using data entered
if (params.has('SubmitPurchase')) {
}
else {
    alert('Please Log in');
    window.location = 'login';
    window.stop();
}
var quantities = [];
if (params.has('submitPurchase')){
    for (i = 0; i < products.length; i++){
        if(params.has(`quantity${i}`)) {
        a_qty = params.get(`quantity${i}`);
        quantities[i] = a_qty;
        }
    }
} else {
    document.write('Please submit a valid quantity!');
}
console.log(qunatities);
</script>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice</title>
    <script src="./product_data.js" type="text/javascript"></script> 
    <link href="product-style.css" rel="stylesheet"> 
    <link rel="stylesheet" href="./product_style.css">
        
    
</head>
<body>
    <table border="1">
    <tbody>
        <tr>
            <th style="text-align: center;" width="43%">Items</th>
            <th style="text-align: center;" width="10%">Quantity</th>
            <th style="text-align: center;" width="13%">Price</th>
            <th style="text-align: center;" width="54%">Extended price</th>
          </tr>
    <script>
    //define subtotal amount
    subtotal = 0;
        for (i = 0; i < products.length; i++) {
          if (quantities[i] > 0) {
            // product row
            extended_price = quantities[i] * products[i].price
            subtotal += extended_price;
            document.write(`
            <tr>
                <td width="43%">${product[i].product}</td>
                <td align="center width="11%">${quantities[i]}</td>
                <td width="13%">\$${products[i].price}</td>
                <td width="54%">\$${extended_price}</td>
            </tr>
            `);
          }
        }
        //compute tax
        var tax_rate = 0.0575;
        var tax = tax_rate * subtotal;

        //compute shipping
        if(subtotal <= 50) {
            shipping = 2;
        }
        else if (subtotal <= 100) {
            shipping = 5;
        }
        else {
            shipping = 0.05 * subtotal; //5% of subtotal
        }

        //compute total
        var total = subtotal + tax + shipping;

        //borrowed code from invoice wod and assignment 1 example template
    </script>
                <tr>
                    <td colspan="4" width="100%">&nbsp;</td>
                </tr>
                <tr>
                    <td style="text-align: center;" colspan="3" width="67%">Sub-Total</td>
                    <td width="54%">$
                        <script>document.write(subtotal.toFixed(2));</script>
                    </td>
                </tr>
                <tr>
                    <td style="text-align: center;" colspan="3" width="67%">Tax</span></td>
                    <td width="54%">$
                        <script>document.write(tax.toFixed(2));</script>
                    </td>
                </tr>
                <tr>
                    <td style="text-align: center;" colspan="3" width="67%">Shipping</span></td>
                    <td width="54%">$
                        <script>document.write(shipping.toFixed(2));</script>
                    </td>
                </tr>
                <tr>
                    <td style="text-align: center;" colspan="3" width="67%"><strong>Total</strong></td>
                    <td width="54%"><strong>$
                            <script>document.write(grandtotal.toFixed(2));</script></strong></td>
                </tr>
                <tr>
                    <td style="text-align: left;" colspan="5" width="121%"><strong>
                            OUR SHIPPING POLICY: <br>
                            A subtotal $0-49.99 will be $2 shipping. <br>
                            A subtotal $50-99.99 will be $5 shipping. <br>
                            A subtotal $100 will be charged 5% of the subtotal amount<br>
                        </strong></td>
                </tr>
            </tbody>
        </table>
        
        <footer>
            <h1>
                Enjoy Your Dessert!
            </h1>
        </footer>   
</body>
</html>